<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <p>
      CLASS lcl_report DEFINITION.
  PUBLIC SECTION.
    METHODS: get_data,
             display_output.
  PRIVATE SECTION.
    TYPES: BEGIN OF ty_data,
             ebeln TYPE ekko-ebeln,
             bukrs TYPE ekko-bukrs,
             bedat TYPE ekko-bedat,
             ernam TYPE ekko-ernam,
             menge TYPE ekpo-menge,
             meins TYPE ekpo-meins,
             netpr TYPE ekpo-netpr,
           END OF ty_data.
    DATA: lt_data TYPE TABLE OF ty_data,
          ls_data TYPE ty_data,
          lv_subtotal_menge TYPE ekpo-menge,
          lv_subtotal_netpr TYPE ekpo-netpr.
ENDCLASS.

CLASS lcl_report IMPLEMENTATION.
  METHOD get_data.
    SELECT a~ebeln a~bukrs a~bedat a~ernam b~menge b~meins b~netpr
      INTO TABLE lt_data
      FROM ekko AS a
      INNER JOIN ekpo AS b ON a~ebeln = b~ebeln
      WHERE a~ebeln IN @s_ebeln.
  ENDMETHOD.

  METHOD display_output.
    DATA: lv_current_ebeln TYPE ekko-ebeln.

    ULINE.
    WRITE: / 'Purchase Order', 20 'Company Code', 40 'Creation Date', 60 'Created By', 80 'Quantity', 100 'Unit', 120 'Net Price'.
    ULINE.

    LOOP AT lt_data INTO ls_data.
      IF lv_current_ebeln IS INITIAL.
        lv_current_ebeln = ls_data-ebeln.
      ENDIF.

      IF lv_current_ebeln <> ls_data-ebeln.
        " Display subtotal
        WRITE: / 'Subtotal', 80 lv_subtotal_menge, 100 ls_data-meins, 120 lv_subtotal_netpr.
        ULINE.
        CLEAR: lv_subtotal_menge, lv_subtotal_netpr.
        lv_current_ebeln = ls_data-ebeln.
      ENDIF.

      WRITE: / ls_data-ebeln, 20 ls_data-bukrs, 40 ls_data-bedat, 60 ls_data-ernam, 80 ls_data-menge, 100 ls_data-meins, 120 ls_data-netpr.
      lv_subtotal_menge = lv_subtotal_menge + ls_data-menge.
      lv_subtotal_netpr = lv_subtotal_netpr + ls_data-netpr.
    ENDLOOP.

    " Display final subtotal
    WRITE: / 'Subtotal', 80 lv_subtotal_menge, 100 ls_data-meins, 120 lv_subtotal_netpr.
    ULINE.
  ENDMETHOD.
ENDCLASS.

START-OF-SELECTION.
  DATA: lr_report TYPE REF TO lcl_report.

  SELECT-OPTIONS: s_ebeln FOR ekko-ebeln.

  CREATE OBJECT lr_report.
  lr_report->get_data( ).
  lr_report->display_output( ).
    </p>
       
    
</body>
</html>